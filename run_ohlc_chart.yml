# ------------------------------
# GitHub Actions å·¥ä½œæµç¨‹ï¼šè‚¡ç¥¨æ•°æ®åˆ†æ
# ------------------------------
name: Stock Data Analysis Pipeline  # å·¥ä½œæµç¨‹åç§°ï¼ˆè‡ªå®šä¹‰ï¼‰

# è§¦å‘æ¡ä»¶ï¼šæ¨é€ä»£ç åˆ° main åˆ†æ”¯æ—¶æ‰§è¡Œ
on:
  push:
    branches: [ "main" ]

# å®šä¹‰ä½œæ¥­ï¼šåœ¨ Ubuntu æœ€æ–°ç¯å¢ƒä¸­è¿è¡Œ
jobs:
  analyze-and-upload:
    runs-on: ubuntu-latest  # ä½¿ç”¨ Ubuntu ç³»ç»Ÿ

    steps:
      # ------------------------------
      # æ­¥éª¤1ï¼šæª¢å‡ºå€‰åº«ä»£ç¢¼ï¼ˆå¿…é ˆï¼‰
      # ------------------------------
      - name: Checkout Repository Code
        uses: actions/checkout@v4  # æœ€æ–°ç‰ˆä»£ç æ£€å‡ºåŠ¨ä½œ
        with:
          fetch-depth: 0  # æ£€å‡ºå®Œæ•´å†å²ï¼ˆç¡®ä¿èƒ½è·å–æ‰€æœ‰æ–‡ä»¶ï¼‰

      # ------------------------------
      # æ­¥éª¤2ï¼šè®¾ç½® Python ç¯å¢ƒ
      # ------------------------------
      - name: Set Up Python Environment
        uses: actions/setup-python@v5  # æœ€æ–°ç‰ˆ Python ç¯å¢ƒé…ç½®
        with:
          python-version: "3.11"  # ä¸æœ¬åœ° Python ç‰ˆæœ¬ä¸€è‡´ï¼ˆå¯æ¢ä¸º 3.10/3.9ï¼‰

      # ------------------------------
      # æ­¥éª¤3ï¼šå®‰è£…é¡¹ç›®ä¾èµ–
      # ------------------------------
      - name: Install Dependencies
        run: |
          # å‡çº§ pip å¹¶å®‰è£… requirements.txt ä¸­çš„ä¾èµ–
          python -m pip install --upgrade pip
          pip install -r requirements.txt  # ä¾èµ–æ–‡ä»¶éœ€æ”¾åœ¨é¡¹ç›®æ ¹ç›®å½•

      # ------------------------------
      # æ­¥éª¤4ï¼šè¿è¡Œä¸»åˆ†æè„šæœ¬
      # ------------------------------
      - name: Run Main Script
        run: |
          python main.py  # æ‰§è¡Œä½ çš„æ•°æ®åˆ†æè„šæœ¬

      # ------------------------------
      # æ­¥éª¤5ï¼šè°ƒè¯•ï¼ˆå¯é€‰ï¼Œæ’æŸ¥æ•°æ®é—®é¢˜ï¼‰
      # ------------------------------
      - name: Debug Data Frame Info
        run: |
          # æ‰“å°æ•°æ®æ¡†åˆ—åï¼ˆéªŒè¯åˆ—åæ˜¯å¦æ­£ç¡®ï¼‰
          echo "ğŸ“Š æ•°æ®åˆ—åï¼š$(python -c "import pandas as pd; df = pd.read_csv('data/0700-HK.csv'); print(','.join(df.columns))")"
          # æ‰“å°å‰5è¡Œæ•°æ®ï¼ˆéªŒè¯æ•°æ®å†…å®¹ï¼‰
          echo "ğŸ” å‰5è¡Œæ•°æ®ï¼š"
          python -c "import pandas as pd; df = pd.read_csv('data/0700-HK.csv'); print(df.head())"

      # ------------------------------
      # æ­¥éª¤6ï¼šä¸Šä¼ åˆ†æç»“æœï¼ˆå·¥ä»¶ï¼‰
      # ------------------------------
      - name: Upload Results as Artifact
        uses: actions/upload-artifact@v4  # æœ€æ–°ç‰ˆå·¥ä»¶ä¸Šä¼ åŠ¨ä½œ
        with:
          name: stock-analysis-${{ github.run_id }}  # å·¥ä»¶åç§°ï¼ˆå«è¿è¡ŒIDï¼Œå”¯ä¸€æ ‡è¯†ï¼‰
          path: |  # æŒ‡å®šè¦ä¸Šä¼ çš„æ–‡ä»¶/ç›®å½•
            ohlc_chart.html  # ç”Ÿæˆçš„Kçº¿å›¾
            data/*.csv       # ç¼“å­˜çš„è‚¡ç¥¨æ•°æ®
          retention-days: 7  # å·¥ä»¶ä¿ç•™7å¤©ï¼ˆå¯è°ƒæ•´1-90å¤©ï¼‰
          if-no-files-found: error  # æ— æ–‡ä»¶æ—¶æŠ›å‡ºé”™è¯¯ï¼ˆé¿å…é™é»˜å¤±è´¥ï¼‰
